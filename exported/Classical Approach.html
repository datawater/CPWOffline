<!DOCTYPE html>

<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="utf-8"/>
<title>Classical Approach - Chessprogramming wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Classical_Approach","wgTitle":"Classical Approach","wgCurRevisionId":25905,"wgRevisionId":25905,"wgArticleId":1112,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Paul Klee"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Classical_Approach","wgRelevantArticleId":1112,"wgRequestId":"Zp7DRbG9G67YuqUGxlgbfAAAAAE","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","wgMFExpandAllSectionsUserOption":false,"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","ext.cite.styles":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0kthzed",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["ext.cite.a11y","site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=ext.cite.styles%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<script async="" src="/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=vector"></script>
<meta content="" name="ResourceLoaderDynamicStyles"/>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<meta content="MediaWiki 1.30.1" name="generator"/>
<meta content="noindex,follow" name="robots"/>
<link href="/images/favicon.ico" rel="shortcut icon"/>
<link href="/opensearch_desc.php" rel="search" title="Chessprogramming wiki (en)" type="application/opensearchdescription+xml"/>
<link href="https://www.chessprogramming.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link href="/Chessprogramming:About" rel="license"/>
<link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="Chessprogramming wiki Atom feed" type="application/atom+xml"/>
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js?40bd4"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Classical_Approach rootpage-Classical_Approach skin-vector action-view"> <div class="noprint" id="mw-page-base"></div>
<div class="noprint" id="mw-head-base"></div>
<div class="mw-body" id="content" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 class="firstHeading" id="firstHeading" lang="en">Classical Approach</h1>
<div class="mw-body-content" id="bodyContent">
<div class="noprint" id="siteSub">From Chessprogramming wiki</div>
<div id="contentSub"></div>
<div class="mw-jump" id="jump-to-nav">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
</div>
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output"><p><b><a href="Main Page.html" title="Main Page">Home</a> * <a href="Board Representation.html" title="Board Representation">Board Representation</a> * <a href="Bitboards.html" title="Bitboards">Bitboards</a> * <a href="Sliding Piece Attacks.html" title="Sliding Piece Attacks">Sliding Piece Attacks</a> * Classical Approach</b>
</p>
<div class="thumb tright"><div class="thumbinner" style="width:302px;"><a class="image" href="File:Classical Grotesque MET DT7804.jpg.html"><img alt="" class="thumbimage" height="249" src="wikipedia/commons/thumb/a/ac/Classical_Grotesque_MET_DT7804.jpg/300px-Classical_Grotesque_MET_DT7804.jpg" srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/Classical_Grotesque_MET_DT7804.jpg/450px-Classical_Grotesque_MET_DT7804.jpg 1.5x, https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/Classical_Grotesque_MET_DT7804.jpg/600px-Classical_Grotesque_MET_DT7804.jpg 2x" width="300"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="File:Classical Grotesque MET DT7804.jpg.html" title="Enlarge"></a></div><a href="Category:Paul Klee.html" title="Category:Paul Klee">Paul Klee</a> - Classical Grotesque, 1923 <sup class="reference" id="cite_ref-1"><a href="#cite note-1">[1]</a></sup></div></div></div>
<p>The classical approach to generate <a href="Sliding Pieces.html" title="Sliding Pieces">sliding piece</a> attacks was probably first used by <a href="Chess (Program).html" title="Chess (Program)">Chess</a> and <a href="Kaissa.html" title="Kaissa">Kaissa</a>.
</p>
<table>
<tr>
<td> <div class="thumb tright"><div class="thumbinner" style="width:51px;"><a href="Square Mapping Considerations.html" title="Square Mapping Considerations"><img alt="Cpwmappinghint.JPG" class="thumbimage" height="48" src="images/4/43/Cpwmappinghint.JPG" width="49"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="File:Cpwmappinghint.JPG.html" title="Enlarge"></a></div></div></div></div>
</td>
<td> <i>Code samples and bitboard diagrams rely on <a href="Square Mapping Considerations.html#LittleEndianRankFileMapping" title="Square Mapping Considerations">Little endian file and rank mapping</a></i>.
</td></tr></table>
<div class="toc" id="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Ray Attacks"><span class="tocnumber">1</span> <span class="toctext">Ray Attacks</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Positive Rays"><span class="tocnumber">1.1</span> <span class="toctext">Positive Rays</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#Conditional"><span class="tocnumber">1.1.1</span> <span class="toctext">Conditional</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#Branchless"><span class="tocnumber">1.1.2</span> <span class="toctext">Branchless</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#Negative Rays"><span class="tocnumber">1.2</span> <span class="toctext">Negative Rays</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Conditional 2"><span class="tocnumber">1.2.1</span> <span class="toctext">Conditional</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Branchless 2"><span class="tocnumber">1.2.2</span> <span class="toctext">Branchless</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#Generalized"><span class="tocnumber">1.3</span> <span class="toctext">Generalized</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Conditional 3"><span class="tocnumber">1.3.1</span> <span class="toctext">Conditional</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Branchless 3"><span class="tocnumber">1.3.2</span> <span class="toctext">Branchless</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Zero Count"><span class="tocnumber">1.4</span> <span class="toctext">Zero Count</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Line Attacks"><span class="tocnumber">2</span> <span class="toctext">Line Attacks</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Piece Attacks"><span class="tocnumber">3</span> <span class="toctext">Piece Attacks</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Union of Line Attacks"><span class="tocnumber">3.1</span> <span class="toctext">Union of Line Attacks</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#In one Run"><span class="tocnumber">3.2</span> <span class="toctext">In one Run</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#See also"><span class="tocnumber">4</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Publications"><span class="tocnumber">5</span> <span class="toctext">Publications</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Forum Posts"><span class="tocnumber">6</span> <span class="toctext">Forum Posts</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#References"><span class="tocnumber">7</span> <span class="toctext">References</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="Ray_Attacks">Ray Attacks</span></h1>
<p>The classical approach works ray-wise and uses pre-calculated <a href="On an empty Board.html#RayAttacks" title="On an empty Board">ray-attacks</a> for each of the eight <a href="Rays.html#RayDirections" title="Rays">ray-directions</a> and each of the 64 <a href="Squares.html" title="Squares">squares</a>. It has to distinguish between <a href="On an empty Board.html#PositiveRays" title="On an empty Board">positive</a> and <a href="On an empty Board.html#NegativeRays" title="On an empty Board">negative</a> directions, because it has to <a href="BitScan.html" title="BitScan">bitscan</a> the ray-attack intersection with the <a href="Occupancy.html" title="Occupancy">occupancy</a> in different orders. That usually don't cares for getting line- or piece attacks, since one likely unrolls all directions needed for a particular line or piece - otherwise one may rely on a <a href="BitScan.html#GeneralizedBitscan" title="BitScan">generalized bitscan</a>.
</p><p><i>We rely on the compass rose to enumerate ray-directions:</i>
</p>
<pre>
  noWe         nort         noEa
          +7    +8    +9
              \  |  /
  west    -1 &lt;-  0 -&gt; +1    east
              /  |  \
          -9    -8    -7
  soWe         sout         soEa
</pre>
<h2><span class="mw-headline" id="Positive_Rays">Positive Rays</span></h2>
<p>Attacks of Positive Ray-Directions:
</p>
<pre>
East (+1)           North (+8)           NorthEast (+9)      NorthWest (+7)
. . . . . . . .     . . . 1 . . . .      . . . . . . . 1     . . . . . . . .
. . . . . . . .     . . . 1 . . . .      . . . . . . 1 .     1 . . . . . . .
. . . . . . . .     . . . 1 . . . .      . . . . . 1 . .     . 1 . . . . . .
. . . . . . . .     . . . 1 . . . .      . . . . 1 . . .     . . 1 . . . . .
. . . R 1 1 1 1     . . . R . . . .      . . . B . . . .     . . . B . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
</pre>
<h3><span class="mw-headline" id="Conditional">Conditional</span></h3>
<p>The first step gets the <a href="On an empty Board.html#RayAttacks" title="On an empty Board">ray-attack</a> on the otherwise empty board. Potential blockers are then determined by intersection with the <a href="Occupancy.html" title="Occupancy">occupancy</a>, the set of all pieces. The first blocker, if any, is the least significant one-bit of the intersection. A <a href="BitScan.html#Bitscanforward" title="BitScan">bitscan forward</a> determines the square of the first blocker, to reset it's ray-bits from the attack set. For instance a bishop on g2:
</p>
<pre>
occupied         &amp;  NorthWest(g2)       {a8, c6}
1 . 1 1 1 1 1 1     1 . . . . . . .     1 . . . . . . .
1 . 1 1 1 1 1 1     . 1 . . . . . .     . . . . . . . .
. 1 1 . . . . .     . . 1 . . . . .     . . 1 . . . . .
. . . . . . . .     . . . 1 . . . .     . . . . . . . .
. . . . . . . .  &amp;  . . . . 1 . . .  =  . . . . . . . .
. . . . . . 1 .     . . . . . 1 . .     . . . . . . . .
1 1 1 1 1 1 B 1     . . . . . . . .     . . . . . . . .
1 1 1 1 1 . 1 1     . . . . . . . .     . . . . . . . .

                    xor NorthWest(c6 = bitscanForward{a8,c6}
                    1 . . . . . . .
                    . 1 . . . . . .
                    . . . . . . . .
                    . . . . . . . .
                    . . . . . . . .
                    . . . . . . . .
                    . . . . . . . .
                    . . . . . . . .

                    =  final northWest Attacks
                    . . . . . . . .
                    . . . . . . . .
                    . . 1 . . . . .
                    . . . 1 . . . .
                    . . . . 1 . . .
                    . . . . . 1 . .
                    . . . . . . . .
                    . . . . . . . .

</pre>
<pre>
U64 rayAttacks[8][64];

U64 getPositiveRayAttacks(U64 occupied, enumDir dir8, enumSquare square) {
   U64 attacks = rayAttacks[dir8][square];
   U64 blocker = attacks &amp; occupied;
   if ( blocker ) {
      square = bitScanForward(blocker);
      attacks ^= rayAttacks[dir8][square];
   }
   return attacks;
}
</pre>
<p><span id="Branchless"></span>
</p>
<h3><span class="mw-headline" id="Branchless">Branchless</span></h3>
<p>Branches are evil with todays super pipelined processors. Even if branch-prediction heuristics become smarter, <a href="Avoiding Branches.html" title="Avoiding Branches">branch-less</a> solutions allow better scheduling and parallel speedup of independent instruction chains, like processing several directions.
</p><p>Considering todays fast <a href="X86-64.html" title="X86-64">x86-64</a> <a href="X86-64.html#gpinstructions" title="X86-64">bsf-instruction</a> of <a class="external text" href="https://en.wikipedia.org/wiki/Intel_Core_2" rel="nofollow">Core 2</a> or <a class="external text" href="https://en.wikipedia.org/wiki/AMD_K10" rel="nofollow">K10</a>, a branch-less solution may be worth a try. Due to the fact the <a href="Occupancy.html" title="Occupancy">occupancy</a> of <a href="First Rank Attacks.html#TheOuterSquares" title="First Rank Attacks">the outer squares</a> doesn't affect the attack set, setting the most significant bit ensures to scan at least an outer square, which would address an empty ray set anyway, therefor not affecting the final result with no blocker or a most outer one.
</p>
<pre>
U64 getRayAttacks(U64 occupied, enumDir dir8, unsigned long square) {
   U64 attacks    = rayAttacks[dir8][square];
   U64 blocker    =  attacks &amp; occupied;
   _BitScanForward64 (&amp;square, blocker | C64(0x8000000000000000));
   return attacks ^ rayAttacks[dir8][square];
}
</pre>
<h2><span class="mw-headline" id="Negative_Rays">Negative Rays</span></h2>
<p>Attacks of Negative Ray-Directions:
</p>
<pre>
West (-1)           South (-8)           SouthWest (-9)      SouthEast (-7)
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
. . . . . . . .     . . . . . . . .      . . . . . . . .     . . . . . . . .
1 1 1 R . . . .     . . . R . . . .      . . . B . . . .     . . . B . . . .
. . . . . . . .     . . . 1 . . . .      . . 1 . . . . .     . . . . 1 . . .
. . . . . . . .     . . . 1 . . . .      . 1 . . . . . .     . . . . . 1 . .
. . . . . . . .     . . . 1 . . . .      1 . . . . . . .     . . . . . . 1 .
</pre>
<h3><span class="mw-headline" id="Conditional_2">Conditional</span></h3>
<p>Works the same way, but needs <a href="BitScan.html#Bitscanreverse" title="BitScan">reverse bitscan</a> to find the first blocking piece, if any.
</p>
<pre>
U64 getNegativeRayAttacks(U64 occupied, enumDir dir8, enumSquare square) {
   U64 attacks = rayAttacks[dir8][square];
   U64 blocker = attacks &amp; occupied;
   if ( blocker ) {
      square = bitScanReverse(blocker);
      attacks ^= rayAttacks[dir8][square];
   }
   return attacks;
}
</pre>
<h3><span class="mw-headline" id="Branchless_2">Branchless</span></h3>
<p>The branch-less solution with a fast <a href="X86-64.html" title="X86-64">x86-64</a> <a href="X86-64.html#gpinstructions" title="X86-64">bsr-instruction</a> allows better scheduling and parallel speedup of independent instruction chains, like processing several directions. Setting the least significant bit ensures to scan at least an outer square, which would address an empty ray set anyway, therefor not affecting the final result with no blocker or a most outer one.
</p>
<pre>
U64 getRayAttacks(U64 occupied, enumDir dir8, unsigned long square) {
   U64 attacks    = rayAttacks[dir8][square];
   U64 blocker    =  attacks &amp; occupied;
   _BitScanReverse64 (&amp;square, blocker | 1);
   return attacks ^ rayAttacks[dir8][square];
}
</pre>
<p><span id="Generalized"></span>
</p>
<h2><span class="mw-headline" id="Generalized">Generalized</span></h2>
<p>The idea of the <a href="BitScan.html#GeneralizedBitscan" title="BitScan">generalized bitscan</a> may be used to share the same code for all directions. The implementation of isNegative(dir8), a macro or inline-function, depends on the definition or enumeration of the directions and is likely a compare or test instruction.
</p>
<h3><span class="mw-headline" id="Conditional_3">Conditional</span></h3>
<p>The conditional by a good predictable branch on blocker is favorable - specially for slow bitscans with some chance to skip it, e.g. in endings.
</p>
<pre>
U64 getRayAttacks(U64 occupied, enumDir dir8, enumSquare square) {
   U64 attacks = rayAttacks[dir8][square];
   U64 blocker = attacks &amp; occupied;
   if ( blocker ) {
      square = bitScan(blocker, isNegative(dir8));
      attacks ^= rayAttacks[dir8][square];
   }
   return attacks;
}
</pre>
<h3><span class="mw-headline" id="Branchless_3">Branchless</span></h3>
<p>The branch-less routine provides a dirMask as universal set for negative rays and the empty set for positive rays, to implement the <a href="BitScan.html#GeneralizedBitscan" title="BitScan">generalized bitscan</a>. The dirBit-or ensures to scan at least outer square with empty ray sets.
</p>
<pre>
U64 getRayAttacks(U64 occupied, enumDir dir8, unsigned long square) {
   U64 attacks    = rayAttacks[dir8][square];
   U64 blocker    =  attacks &amp; occupied;
   blocker       &amp;= -blocker | dirMask[dir8];
   blocker       |=            dirBit [dir8]
   _BitScanReverse64 (&amp;square, blocker | dirBit[dir8]);
   return attacks ^ rayAttacks[dir8][square];
}
</pre>
<h2><span class="mw-headline" id="Zero_Count">Zero Count</span></h2>
<p>If available, Leading- or Trailing Zero Count instructions may be used instead of bitscan for another branch-less solution of the classical attack getter. Since they leave 64 for empty sets, it needs to make the ray attack <a href="Array.html" title="Array">arrays</a> one greater to allow index by 64 which contains an empty set - or one needs to map 64 to 63 for positive directions.
</p>
<pre>
U64 rayAttacks[8][65];

U64 getPositiveRayAttacks(U64 occupied, enumDir dir8, enumSquare square) {
   U64 attacks = rayAttacks[dir8][square];
   U64 blocker = attacks &amp; occupied;
   int firstBlockingSquare = trailingZeroCount(blocker);
   attacks ^= rayAttacks[dir8][firstBlockingSquare];
   return attacks;
}
</pre>
<p>LeadingZeroCount instead of bitscanReverse may be done similarly, considering the reversed order.
</p><p><span id="Wrapper"></span>
</p>
<h1><span class="mw-headline" id="Line_Attacks">Line Attacks</span></h1>
<p>As mentioned, line attacks are the <a href="General Setwise Operations.html#Union" title="General Setwise Operations">union</a> of positive and opposite negative <a href="Rays.html#RayDirections" title="Rays">ray-directions</a> - since they are disjoint one may also use 'xor' or 'add':
</p>
<pre>
U64 diagonalAttacks(U64 occ, enumSquare sq) {
  return getPositiveRayAttacks(occ, noEa, sq)
       | getNegativeRayAttacks(occ, soWe, sq); // ^ +
}

U64 antiDiagAttacks(U64 occ, enumSquare sq) {
  return getPositiveRayAttacks(occ, noWe, sq)
       | getNegativeRayAttacks(occ, soEa, sq); // ^ +
}

U64 fileAttacks (U64 occ, enumSquare sq) {
  return getPositiveRayAttacks(occ, nort, sq)
       | getNegativeRayAttacks(occ, sout, sq); // ^ +
}

U64 rankAttacks (U64 occ, enumSquare sq) {
  return getPositiveRayAttacks(occ, east, sq)
       | getNegativeRayAttacks(occ, west, sq); // ^ +
}
</pre>
<h1><span class="mw-headline" id="Piece_Attacks">Piece Attacks</span></h1>
<h2><span class="mw-headline" id="Union_of_Line_Attacks">Union of Line Attacks</span></h2>
<p>Of course piece attacks are the union of the line attacks:
</p>
<pre>
U64 rookAttacks (U64 occ, enumSquare sq) {
  return fileAttacks(occ, sq)
       | rankAttacks(occ, sq); // ^ +
}

U64 bishopAttacks (U64 occ, enumSquare sq) {
  return diagonalAttacks(occ, sq)
       | antiDiagAttacks(occ, sq); // ^ +
}

U64 queenAttacks (U64 occ, enumSquare sq) {
  return rookAttacks  (occ, sq)
       | bishopAttacks(occ, sq); // ^ +
}
</pre>
<p><span id="InOneRun"></span>
</p>
<h2><span class="mw-headline" id="In_one_Run">In one Run</span></h2>
<p>As mentioned by <a href="Robert Hyatt.html" title="Robert Hyatt">Robert Hyatt</a> <sup class="reference" id="cite_ref-2"><a href="#cite note-2">[2]</a></sup>, instead of fetching four <a href="On an empty Board.html#RayAttacks" title="On an empty Board">ray-attacks</a> on the otherwise empty board, one may already use the <a href="On an empty Board.html#PieceAttacks" title="On an empty Board">rook- or bishop attacks</a> to reset outer squares from that union set. 
</p><p>A further improvement was suggested by <a href="Michael Sherwin.html" title="Michael Sherwin">Michael Sherwin</a> <sup class="reference" id="cite_ref-3"><a href="#cite note-3">[3]</a></sup>, to union the occupancy with the outer bits 0 and 63. Together with appropriate bits set in separate ray-masks, this yields to an efficient branchless solution with 13 64-bit operations in total and 4.5 KByte for the lookup tables for both rooks and bishops each.
</p>
<pre>
struct {
  U64 bitsN;  // bits North, including MSB (bit 63)
  U64 bitsE;  // bits East, including MSB
  U64 bitsS;  // bits South, including LSB (bit 0 == 1)
  U64 bitsW;  // bits West, including LSB 
} CACHE_ALIGN rayWstop[64]; 

U64 attacksEmpty[64];
U64 rayN[64];
U64 rayE[64];
U64 rayS[64];
U64 rayW[64];

U64 rookAttacks(U64 occ, unsigned int sq) {
   unsigned long ulN, ulE, ulS, ulW;
   occ |= C64(0x8000000000000001);
   _BitScanForward64(&amp;ulN, occ &amp; rayWstop[sq].bitsN);
   _BitScanForward64(&amp;ulE, occ &amp; rayWstop[sq].bitsE);
   _BitScanReverse64(&amp;ulS, occ &amp; rayWstop[sq].bitsS);
   _BitScanReverse64(&amp;ulW, occ &amp; rayWstop[sq].bitsW);
   return attacksEmpty[sq]^rayN[ulN]^rayE[ulE]^rayS[ulS]^rayW[ulW];
} 
</pre>
<h1><span class="mw-headline" id="See_also">See also</span></h1>
<ul><li> <a href="Bitfoot.html#ABBitboards" title="Bitfoot">Bitfoot - A/B Bitboards</a></li>
<li> <a href="Blockers and Beyond.html" title="Blockers and Beyond">Blockers and Beyond</a></li>
<li> <a href="CFish.html#AVX2 Attacks" title="CFish">CFish - AVX2 Attacks</a></li>
<li> <a href="Obstruction Difference.html" title="Obstruction Difference">Obstruction Difference</a></li>
<li> <a href="Pieces versus Directions.html" title="Pieces versus Directions">Pieces versus Directions</a></li></ul>
<h1><span class="mw-headline" id="Publications">Publications</span></h1>
<ul><li> <a href="Stuart Cracraft.html" title="Stuart Cracraft">Stuart Cracraft</a> (<b>1984</b>). <i>Bitmap move generation in Chess</i>. <a href="ICGA Journal.html" title="ICGA Journal">ICCA Journal</a>, Vol. 7, No. 3, pp. 146–153</li>
<li> <a href="Fridel Fainshtein.html" title="Fridel Fainshtein">Fridel Fainshtein</a> (<b>2006</b>). <i>An Orthodox k-Move Problem-Composer for Chess Directmates</i>. M.Sc. thesis, <a href="Bar-Ilan University.html" title="Bar-Ilan University">Bar-Ilan University</a>,  <a class="external text" href="http://www.problemschach.de/KMOVEComposer.pdf.html" rel="nofollow">pdf</a>, Appendix D - 64-bit Representation, pp. 105</li>
<li> <a href="Fridel Fainshtein.html" title="Fridel Fainshtein">Fridel Fainshtein</a>, <a href="Yaakov HaCohen-Kerner.html" title="Yaakov HaCohen-Kerner">Yaakov HaCohen-Kerner</a> (<b>2006</b>). <i>A Chess Composer of Two-Move Mate Problems</i>. <a href="ICGA Journal.html" title="ICGA Journal">ICGA Journal</a>, Vol. 29, No. 1, <a class="external text" href="http://homedir.jct.ac.il/~kerner/pdf docs/ICGA computer composer.pdf.html" rel="nofollow">pdf</a>, Appendix E: 64-bit representation</li></ul>
<h1><span class="mw-headline" id="Forum_Posts">Forum Posts</span></h1>
<ul><li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?topic view=threads&amp;p=257692&amp;t=27113.html" rel="nofollow">Re: Thinker output</a> by <a href="Robert Hyatt.html" title="Robert Hyatt">Robert Hyatt</a>, <a href="CCC.html" title="CCC">CCC</a>, March 25, 2009</li>
<li> <a class="external text" href="https://www.talkchess.com/forum3/viewtopic.php?f=7&amp;t=30356&amp;start=14" rel="nofollow">Re: Yet another bitboard attack generator</a> by <a href="Robert Hyatt.html" title="Robert Hyatt">Robert Hyatt</a>, <a href="CCC.html" title="CCC">CCC</a>, October 28, 2009 </li>
<li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=30971.html" rel="nofollow">Modified old 64 bit attack getter</a> by <a href="Michael Sherwin.html" title="Michael Sherwin">Michael Sherwin</a>, <a href="CCC.html" title="CCC">CCC</a>, December 06, 2009</li>
<li> <a class="external text" href="https://www.talkchess.com/forum3/viewtopic.php?f=7&amp;t=78562" rel="nofollow">Bob used to do it this way</a> by <a href="Michael Sherwin.html" title="Michael Sherwin">Mike Sherwin</a>, <a href="CCC.html" title="CCC">CCC</a>, October 31, 2021</li></ul>
<h1><span class="mw-headline" id="References">References</span></h1>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite ref-1">↑</a></span> <span class="reference-text"><a href="Category:Paul Klee.html" title="Category:Paul Klee">Paul Klee</a> - <a class="external text" href="https://commons.wikimedia.org/wiki/File:Classical_Grotesque_MET_DT7804.jpg" rel="nofollow">Classical Grotesque</a>, 1923, <a class="external text" href="https://en.wikipedia.org/wiki/Wikimedia_Commons" rel="nofollow">Wikimedia Commons</a>, <a class="external text" href="https://en.wikipedia.org/wiki/Metropolitan_Museum_of_Art" rel="nofollow">Metropolitan Museum of Art</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite ref-2">↑</a></span> <span class="reference-text"><a class="external text" href="https://www.talkchess.com/forum3/viewtopic.php?f=7&amp;t=30356&amp;start=14" rel="nofollow">Re: Yet another bitboard attack generator</a> by <a href="Robert Hyatt.html" title="Robert Hyatt">Robert Hyatt</a>, <a href="CCC.html" title="CCC">CCC</a>, October 28, 2009 </span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite ref-3">↑</a></span> <span class="reference-text"><a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=30971.html" rel="nofollow">Modified old 64 bit attack getter</a> by <a href="Michael Sherwin.html" title="Michael Sherwin">Michael Sherwin</a>, <a href="CCC.html" title="CCC">CCC</a>, December 06, 2009</span>
</li>
</ol></div>
<p><b><a href="Sliding Piece Attacks.html" title="Sliding Piece Attacks">Up one Level</a></b>
</p>
<!-- 
NewPP limit report
Cached time: 20240722175330
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.076 seconds
Real time usage: 1.017 seconds
Preprocessor visited node count: 255/1000000
Preprocessor generated node count: 492/1000000
Post‐expand include size: 243/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.973      1 Template:MappingHint
100.00%    0.973      1 -total
-->
</div>
<!-- Saved in parser cache with key oscar70_mw1-mw_:pcache:idhash:1112-0!canonical and timestamp 20240722175329 and revision id 25905
 -->
</div> <div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://www.chessprogramming.org/index.php?title=Classical_Approach&amp;oldid=25905">https://www.chessprogramming.org/index.php?title=Classical_Approach&amp;oldid=25905</a>"					</div>
<div class="catlinks" data-mw="interface" id="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a href="Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category:Paul Klee.html" title="Category:Paul Klee">Paul Klee</a></li></ul></div></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div aria-labelledby="p-personal-label" class="" id="p-personal" role="navigation">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-login"><a accesskey="o" href="index.php?title=Special:UserLogin&amp;returnto=Classical+Approach&amp;returntoquery=printable%3Dyes.html" title="You are encouraged to log in; however, it is not mandatory [o]">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div aria-labelledby="p-namespaces-label" class="vectorTabs" id="p-namespaces" role="navigation">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li class="selected" id="ca-nstab-main"><span><a accesskey="c" href="Classical Approach.html" title="View the content page [c]">Page</a></span></li>
<li class="new" id="ca-talk"><span><a accesskey="t" href="index.php?title=Talk:Classical Approach&amp;action=edit&amp;redlink=1.html" rel="discussion" title="Discussion about the content page [t]">Discussion</a></span></li>
</ul>
</div>
<div aria-labelledby="p-variants-label" class="vectorMenu emptyPortlet" id="p-variants" role="navigation">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div aria-labelledby="p-views-label" class="vectorTabs" id="p-views" role="navigation">
<h3 id="p-views-label">Views</h3>
<ul>
<li class="selected" id="ca-view"><span><a href="Classical Approach.html">Read</a></span></li>
<li id="ca-viewsource"><span><a accesskey="e" href="index.php?title=Classical Approach&amp;action=edit.html" title="This page is protected.
You can view its source [e]">View source</a></span></li>
<li class="collapsible" id="ca-history"><span><a accesskey="h" href="index.php?title=Classical Approach&amp;action=history.html" title="Past revisions of this page [h]">View history</a></span></li>
</ul>
</div>
<div aria-labelledby="p-cactions-label" class="vectorMenu emptyPortlet" id="p-cactions" role="navigation">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/index.php" id="searchform">
<div id="simpleSearch">
<input accesskey="f" id="searchInput" name="search" placeholder="Search Chessprogramming wiki" title="Search Chessprogramming wiki [f]" type="search"/><input name="title" type="hidden" value="Special:Search"/><input class="searchButton mw-fallbackSearchButton" id="mw-searchButton" name="fulltext" title="Search the pages for this text" type="submit" value="Search"/><input class="searchButton" id="searchButton" name="go" title="Go to a page with this exact name if it exists" type="submit" value="Go"/> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main Page.html" title="Visit the main page"></a></div>
<div aria-labelledby="p-navigation-label" class="portal" id="p-navigation" role="navigation">
<h3 id="p-navigation-label">Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a accesskey="z" href="Main Page.html" title="Visit the main page [z]">Main page</a></li><li id="n-recentchanges"><a accesskey="r" href="Special:RecentChanges.html" title="A list of recent changes in the wiki [r]">Recent changes</a></li><li id="n-randompage"><a accesskey="x" href="Special:Random.html" title="Load a random page [x]">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li> </ul>
</div>
</div>
<div aria-labelledby="p-tb-label" class="portal" id="p-tb" role="navigation">
<h3 id="p-tb-label">Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a accesskey="j" href="Special:WhatLinksHere/Classical Approach.html" title="A list of all wiki pages that link here [j]">What links here</a></li><li id="t-recentchangeslinked"><a accesskey="k" href="Special:RecentChangesLinked/Classical Approach.html" rel="nofollow" title="Recent changes in pages linked from this page [k]">Related changes</a></li><li id="t-specialpages"><a accesskey="q" href="Special:SpecialPages.html" title="A list of all special pages [q]">Special pages</a></li><li id="t-permalink"><a href="index.php?title=Classical Approach&amp;oldid=25905.html" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="index.php?title=Classical Approach&amp;action=info.html" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 4 November 2021, at 10:05.</li>
<li id="footer-info-copyright">Content is available under <a href="Chessprogramming:About.html" title="Chessprogramming:About">Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="Chessprogramming:Privacy policy.html" title="Chessprogramming:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="Chessprogramming:About.html" title="Chessprogramming:About">About Chessprogramming wiki</a></li>
<li id="footer-places-disclaimer"><a href="Chessprogramming:General disclaimer.html" title="Chessprogramming:General disclaimer">Disclaimers</a></li>
<li id="footer-places-mobileview"><a class="noprint stopMobileRedirectToggle" href="https://www.chessprogramming.org/index.php?title=Classical_Approach&amp;printable=yes&amp;mobileaction=toggle_view_mobile">Mobile view</a></li>
</ul>
<ul class="noprint" id="footer-icons">
<li id="footer-copyrightico">
<a href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)" height="31" src="images/cc-by-sa.png" width="88"/></a> </li>
<li id="footer-poweredbyico">
<a href="/www.mediawiki.org/.html"><img alt="Powered by MediaWiki" height="31" src="resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88"/></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.076","walltime":"1.017","ppvisitednodes":{"value":255,"limit":1000000},"ppgeneratednodes":{"value":492,"limit":1000000},"postexpandincludesize":{"value":243,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    0.973      1 Template:MappingHint","100.00%    0.973      1 -total"]},"cachereport":{"timestamp":"20240722175330","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":53});});</script>
</body>
</html>
