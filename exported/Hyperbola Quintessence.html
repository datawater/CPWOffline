<!DOCTYPE html>

<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="utf-8"/>
<title>Hyperbola Quintessence - Chessprogramming wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Hyperbola_Quintessence","wgTitle":"Hyperbola Quintessence","wgCurRevisionId":13377,"wgRevisionId":13377,"wgArticleId":1629,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Samuel Bak","Focus"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Hyperbola_Quintessence","wgRelevantArticleId":1629,"wgRequestId":"Zp7DYar3TkUYSeSKrHxdSwAAAA8","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","wgMFExpandAllSectionsUserOption":false,"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","ext.cite.styles":"ready","ext.embedVideo.styles":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0kthzed",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["ext.cite.a11y","ext.embedVideo","site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=ext.cite.styles%7Cext.embedVideo.styles%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<script async="" src="/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=vector"></script>
<meta content="" name="ResourceLoaderDynamicStyles"/>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<meta content="MediaWiki 1.30.1" name="generator"/>
<meta content="noindex,follow" name="robots"/>
<link href="/images/favicon.ico" rel="shortcut icon"/>
<link href="/opensearch_desc.php" rel="search" title="Chessprogramming wiki (en)" type="application/opensearchdescription+xml"/>
<link href="https://www.chessprogramming.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link href="/Chessprogramming:About" rel="license"/>
<link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="Chessprogramming wiki Atom feed" type="application/atom+xml"/>
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js?40bd4"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Hyperbola_Quintessence rootpage-Hyperbola_Quintessence skin-vector action-view"> <div class="noprint" id="mw-page-base"></div>
<div class="noprint" id="mw-head-base"></div>
<div class="mw-body" id="content" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 class="firstHeading" id="firstHeading" lang="en">Hyperbola Quintessence</h1>
<div class="mw-body-content" id="bodyContent">
<div class="noprint" id="siteSub">From Chessprogramming wiki</div>
<div id="contentSub"></div>
<div class="mw-jump" id="jump-to-nav">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
</div>
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output"><p><b><a href="Main Page.html" title="Main Page">Home</a> * <a href="Board Representation.html" title="Board Representation">Board Representation</a> * <a href="Bitboards.html" title="Bitboards">Bitboards</a> * <a href="Sliding Piece Attacks.html" title="Sliding Piece Attacks">Sliding Piece Attacks</a> * Hyperbola Quintessence</b>
</p>
<div class="thumb tright"><div class="thumbinner" style="width:302px;"><a class="image" href="File:SamuelBakReflexion.jpg.html"><img alt="" class="thumbimage" height="247" src="images/thumb/9/91/SamuelBakReflexion.jpg/300px-SamuelBakReflexion.jpg" srcset="/images/9/91/SamuelBakReflexion.jpg 1.5x" width="300"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="File:SamuelBakReflexion.jpg.html" title="Enlarge"></a></div><a href="Category:Samuel Bak.html" title="Category:Samuel Bak">Samuel Bak</a> - Reflexion, 1990 <sup class="reference" id="cite_ref-1"><a href="#cite note-1">[1]</a></sup></div></div></div>
<p><b>Hyperbola Quintessence</b> applies the <a href="Subtracting a Rook from a Blocking Piece.html" title="Subtracting a Rook from a Blocking Piece">o^(o-2r)-trick</a> also for vertical or diagonal <a href="On an empty Board.html#NegativeRays" title="On an empty Board">negative Rays</a> - by reversing the bit-order of up to one bit per rank or <a href="Byte.html" title="Byte">byte</a> with a <a href="Flipping Mirroring and Rotating.html#FlipVertically" title="Flipping Mirroring and Rotating">vertical flip</a> aka <a href="X86-64.html" title="X86-64">x86-64</a> <a href="X86-64.html#gpinstructions" title="X86-64">bswap</a> <sup class="reference" id="cite_ref-2"><a href="#cite note-2">[2]</a></sup> . It is somehow a resurrection of the <a href="Reverse Bitboards.html" title="Reverse Bitboards">reverse bitboards</a> idea of <a href="Ryan Mack.html" title="Ryan Mack">Ryan Mack's</a> <i>Hyperbola Project</i> on the fly, and was created by <a href="Gerd Isenberg.html" title="Gerd Isenberg">Gerd Isenberg</a>. Improvements by <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a> <sup class="reference" id="cite_ref-3"><a href="#cite note-3">[3]</a></sup> made it applicable and competitive.
</p>
<table>
<tr>
<td> <div class="thumb tright"><div class="thumbinner" style="width:51px;"><a href="Square Mapping Considerations.html" title="Square Mapping Considerations"><img alt="Cpwmappinghint.JPG" class="thumbimage" height="48" src="images/4/43/Cpwmappinghint.JPG" width="49"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="File:Cpwmappinghint.JPG.html" title="Enlarge"></a></div></div></div></div>
</td>
<td> <i>Code samples and bitboard diagrams rely on <a href="Square Mapping Considerations.html#LittleEndianRankFileMapping" title="Square Mapping Considerations">Little endian file and rank mapping</a></i>.
</td></tr></table>
<div class="toc" id="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Reverse Math"><span class="tocnumber">1</span> <span class="toctext">Reverse Math</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Source Code"><span class="tocnumber">2</span> <span class="toctext">Source Code</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#C"><span class="tocnumber">2.1</span> <span class="toctext">C</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Generalized Set-wise Attacks"><span class="tocnumber">2.2</span> <span class="toctext">Generalized Set-wise Attacks</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#x86-64 assembly"><span class="tocnumber">2.3</span> <span class="toctext">x86-64 assembly</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Java"><span class="tocnumber">2.4</span> <span class="toctext">Java</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#See also"><span class="tocnumber">3</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Forum Posts"><span class="tocnumber">4</span> <span class="toctext">Forum Posts</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#External Links"><span class="tocnumber">5</span> <span class="toctext">External Links</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Hyperbola"><span class="tocnumber">5.1</span> <span class="toctext">Hyperbola</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Quintessence"><span class="tocnumber">5.2</span> <span class="toctext">Quintessence</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Misc"><span class="tocnumber">5.3</span> <span class="toctext">Misc</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#References"><span class="tocnumber">6</span> <span class="toctext">References</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="Reverse_Math">Reverse Math</span></h1>
<p>Assume following masked <a href="Occupancy.html" title="Occupancy">occupancy</a> on a <a href="Files.html" title="Files">file</a>, <a href="Diagonals.html" title="Diagonals">diagonal</a> or <a href="Anti-Diagonals.html" title="Anti-Diagonals">anti-diagonal</a> - for simplicity as a flat byte (in a real bitboard with masked files or diagonals you have 6..8 scratch-bits between the bits of this byte). Thus, vertical flip reverses the bits of this byte.
</p>
<pre>
o' = reverse(o)
r' = reverse(r)

       normal    reversed
 o     11010101  10101011 o' occupancy including slider
 r     00010000  00001000 r' slider
 o-r   11000101  10100011 o'-r'  1. sub clears the slider
 o-2r  10110101  10011011 o'-2r' 2. sub borrows "one" from next blocker
       |......|  \....../
normal 10110101   \..../
       11011001 &lt;--XXXX   re-reverse
single
xor    01101100 -&gt; to get the attack set
</pre>
<p>The first subtraction of (o-2r) is done implicitly by masking off the line, removing the slider from the occupied set. The second subtraction borrows a "one" from the next nearest blocker in msb-direction, falling through all unset bits outside the line. Of course, if no blocker is available, it borrows a "one" in usual arithmetical manner from the hidden 2^N. Only the changed bits (from original o, o') are the appropriate sliding attacks, including the blocker but excluding the slider. The result finally needs to be intersected with the same line mask as previously the occupancy, to clear the wrapped borrow one bits outside the file or diagonal. The fine optimization by <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a> covers the final <a href="General Setwise Operations.html#Union" title="General Setwise Operations">union</a> of <a href="On an empty Board.html#PositiveRays" title="On an empty Board">positive</a> and <a href="On an empty Board.html#NegativeRays" title="On an empty Board">negative ray-attacks</a>. Since opposed <a href="Rays.html#RayDirections" title="Rays">ray-directions</a> are always disjoint sets, using <a href="General Setwise Operations.html#ExclusiveOr" title="General Setwise Operations">xor</a> instead of <i>bitwise or</i> safes two instructions per line-attack. That is because bit-reversal or any <a href="Flipping Mirroring and Rotating.html" title="Flipping Mirroring and Rotating">mirroring or flipping</a> is own inverse and distributive over xor.
</p>
<pre>
reverse(a ^ b) == reverse (a) ^ reverse(b)
</pre>
<p>thus
</p>
<pre>
lineAttacks = o^(o-2r) ^ reverse((o'-2r')^o')
lineAttacks = o^(o-2r) ^ reverse( o'-2r') ^ reverse(o')
lineAttacks = o^(o-2r) ^ reverse( o'-2r') ^ o
</pre>
<p>and finally
</p>
<pre>
lineAttacks =   (o-2r) ^ reverse( o'-2r')
</pre>
<p>Beside shorter code this reduces register pressure - and clearly outperforms <a href="Kindergarten Bitboards.html" title="Kindergarten Bitboards">kindergarten bitboards</a> - <a class="external text" href="https://en.wikipedia.org/wiki/Instructions_Per_Cycle" rel="nofollow">ipc</a>-wise, in code size and memory requirements.
</p>
<h1><span class="mw-headline" id="Source_Code">Source Code</span></h1>
<h2><span class="mw-headline" id="C">C</span></h2>
<p>The three <a href="C.html" title="C">C</a>-routines only differ by the line-mask applied:
</p>
<pre>
U64 diagonalAttacks(U64 occ, enumSquare sq) {
   U64 forward, reverse;
   forward = occ &amp; smsk[sq].diagonalMaskEx;
   reverse  = _byteswap_uint64(forward);
   forward -= smsk[sq].bitMask;
   reverse -= _byteswap_uint64(smsk[sq].bitMask);
   forward ^= _byteswap_uint64(reverse);
   forward &amp;= smsk[sq].diagonalMaskEx;
   return forward;
}

U64 antiDiagAttacks(U64 occ, enumSquare sq) {
   U64 forward, reverse;
   forward  = occ &amp; smsk[sq].antidiagMaskEx;
   reverse  = _byteswap_uint64(forward);
   forward -= smsk[sq].bitMask;
   reverse -= _byteswap_uint64(smsk[sq].bitMask);
   forward ^= _byteswap_uint64(reverse);
   forward &amp;= smsk[sq].antidiagMaskEx;
   return forward;
}

U64 fileAttacks(U64 occ, enumSquare sq) {
   U64 forward, reverse;
   forward  = occ &amp; smsk[sq].fileMaskEx;
   reverse  = _byteswap_uint64(forward);
   forward -= smsk[sq].bitMask;
   reverse -= _byteswap_uint64(smsk[sq].bitMask);
   forward ^= _byteswap_uint64(reverse);
   forward &amp;= smsk[sq].fileMaskEx;
   return forward;
}

U64 bishopAttacks(U64 occ, enumSquare sq) {
   return diagonalAttacks (occ, sq)
        + antiDiagAttacks (occ, sq);
}
</pre>
<p><span id="ArrayOfStructs"></span>
For better locality of the <a href="On an empty Board.html" title="On an empty Board">line-attacks</a> on the otherwise empty board, we may use an properly aligned array of structs.
</p>
<pre>
struct
{
   U64 bitMask;         // 1 &lt;&lt; sq for convenience
   U64 diagonalMaskEx;
   U64 antidiagMaskEx;
   U64 fileMaskEx;
} smsk[64]; // 2 KByte
</pre>
<p>Using <a href="X86-64.html" title="X86-64">x86-64</a> <a href="X86-64.html#gpinstructions" title="X86-64">bswap</a> makes it quite competitive for bishops and files, on <a href="AMD.html" title="AMD">AMD</a> <a class="external text" href="https://en.wikipedia.org/wiki/Athlon_64" rel="nofollow">K8</a> or <a class="external text" href="https://en.wikipedia.org/wiki/AMD_K10" rel="nofollow">K10</a> it has a latency of one cycle with a throughput of 1/3, like other cheap instructions. However, <a href="Intel.html" title="Intel">Intel</a> is tad slower - while the recent <a class="external text" href="https://en.wikipedia.org/wiki/Intel_Core_2" rel="nofollow">Core 2 duo</a> processors perform 128-bit SIMD-instructions with 128-bit alus, that is bitwise logical instructions with a latency of one cycle and throughput of 1/3, the general purpose bswap-instruction takes four cycles with a throughput of one. In <i>Intel 64 and IA32 Architectures Optimization Reference Manual</i> <sup class="reference" id="cite_ref-4"><a href="#cite note-4">[4]</a></sup> , it is therefor recommend (5.6.5. endian conversion) to use the <a href="SSSE3.html" title="SSSE3">SSSE3</a> <a href="SSSE3.html#Pshufb" title="SSSE3">pshufb</a> instruction to swap bytes, available through intrinsic <sup class="reference" id="cite_ref-5"><a href="#cite note-5">[5]</a></sup> , see <a href="SSSE3.html#SSSE3Version" title="SSSE3">SSSE3 Hyperbola Quintessence</a> for bishop attacks.
</p><p>As long there is no fast bit reversal instruction, there is no general solution for all four lines, and the rook attack-getter still needs some standard technique for the <a href="First Rank Attacks.html#AttacksOnAllRanks" title="First Rank Attacks">rank-attacks</a>. Tim Cooijmans proposed to map the rank to the main diagonal before applying HQ, and to re-map the calculated attacks back to the original rank <sup class="reference" id="cite_ref-6"><a href="#cite note-6">[6]</a></sup> .
</p>
<h2><span class="mw-headline" id="Generalized_Set-wise_Attacks">Generalized Set-wise Attacks</span></h2>
<p>Hyperbola quintessence can be generalized to work on whole sets of sliding pieces instead on individual pieces, whose ranks to be masked. The problem arising, when not masking the rank of the piece is that attacks wrap around the board during subtraction. This is shown below:
</p>
<pre>
     ........       ........                            11111111
     ........       ........                            11111111
     ........       ........                            11111111
 r = ........ , o = ........ this leads to   o - 2*r =  11111111
     ........       ........                            11111111
     ........       ........                            11111111
     ....1...       ....1...                            11111...
     ........       ........                            ........

instead of

........
........
........
........
........
........
11111...
........
</pre>
<p>This is not the intended result. It can be avioded, by bitwise adding an overflow barrier on the right-hand side. Afterwards this barrier needs to be removed from the attack set:
</p>
<pre>
u64 right = 0x0101010101010101ULL;

     ......1.      1..1..1.                              1...1111
     ....1...      1...1...                              .1111..1
     ......1.      11....1.                              1.111111
r =  .....1..  o = .11..1..   now: ((o | right) - 2*r) = .1.111.1
     ........      ........                              ........
     ......1.      ......1.                              1111111.
     .......1      .......1                              1111111.
     1.......      1.......                              1......1

Note, that the 4th rank was not flooded by the subtraction! Next, the blockers are removed as usual:

                          ...111.1
                          1111...1
                          .11111.1
o ^ ((o | right) - 2*r) = ..111..1
                          ........
                          111111..
                          11111111
                          .......1

The last step is to remove the barrier at the right side that became visible after the last operation.

                                     ...111..
                                     1111...
                                     .11111..
(o ^ ((o | right) - 2*r) &amp; ~right =  ..111...
                                     ........
                                     111111..
                                     1111111.
                                     ........

This is the correct attack set for the left direction.

</pre>
<p>the complete algorithm for the left direction is therefore:
</p>
<pre>
const u64 right = 0x0101010101010101ULL;

u64 leftAttacks = ((o ^ ((o | right) - 2*r) &amp; ~right);
</pre>
<p>For the right-hand direction, the bits need to be reversed rank-wise.
</p>
<h2><span class="mw-headline" id="x86-64_assembly">x86-64 assembly</span></h2>
<p>The VC2005 generated <a href="X86-64.html" title="X86-64">x86-64</a> <a href="Assembly.html" title="Assembly">assembly</a> of bishopAttacks indicates what <a class="external text" href="https://en.wikipedia.org/wiki/Instructions_Per_Cycle" rel="nofollow">ipc</a>-monster Hyperbola Quintessence is:
</p>
<pre>
occ$ = 16
sq$ = 24
?bishopAttacks@@YA_K_KI@Z PROC
  00000   40 53                push    rbx
  00002   8b c2                mov    eax, edx
  00004   4c 8d 15 00 00 00 00 lea    r10, OFFSET FLAT:?smsk
  0000b   48 c1 e0 05          shl    rax, 5
  0000f   4a 8b 5c 10 08       mov    rbx, QWORD PTR [rax+r10+8]  ; diagonalMaskEx
  00014   4e 8b 4c 10 10       mov    r9,  QWORD PTR [rax+r10+16] ; antidiagMaskEx
  00019   4e 8b 14 10          mov    r10, QWORD PTR [rax+r10]    ; r := 1 &lt;&lt; sq
  0001d   4c 8b db             mov    r11, rbx                    ; diagonalMaskEx
  00020   49 8b d1             mov    rdx, r9                     ; antidiagMaskEx
  00023   4d 8b c2             mov    r8, r10                     ; r := 1 &lt;&lt; sq
  00026   48 23 d1             and    rdx, rcx                    ; anti &amp; occ
  00029   4c 23 d9             and    r11, rcx                    ; dia  &amp; occ
  0002c   49 0f c8             bswap  r8                          ; r'
  0002f   48 8b c2             mov    rax, rdx                    ; ant
  00032   49 8b cb             mov    rcx, r11                    ; dia
  00035   49 2b d2             sub    rdx, r10                    ; ant - r
  00038   48 0f c8             bswap  rax                         ; ant'
  0003b   48 0f c9             bswap  rcx                         ; dia'
  0003e   4d 2b da             sub    r11, r10                    ; dia - r
  00041   49 2b c0             sub    rax, r8                     ; ant' - r'
  00044   49 2b c8             sub    rcx, r8                     ; dia' - r'
  00047   48 0f c8             bswap  rax                         ;(ant' - r')'
  0004a   48 0f c9             bswap  rcx                         ;(dia' - r')'
  0004d   48 33 c2             xor    rax, rdx                    ; ant := (ant' - r')' ^ (ant - r)
  00050   49 33 cb             xor    rcx, r11                    ; dia := (dia' - r')' ^ (dia - r)
  00053   49 23 c1             and    rax, r9                     ; ant &amp;= antidiagMaskEx
  00056   48 23 cb             and    rcx, rbx                    ; dia &amp;= diagonalMaskEx
  00059   48 03 c1             add    rax, rcx                    ; attacks := dia + ant
  0005c   5b                   pop    rbx
  0005d   c3                   ret    0
?bishopAttacks@@YA_K_KI@Z ENDP
</pre>
<h2><span class="mw-headline" id="Java">Java</span></h2>
<p><a href="Java.html" title="Java">Java</a> programmer may try <a class="external text" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Long.html.html#reverseBytes%28long%29" rel="nofollow">Long.reverseBytes</a>:
</p>
<pre>
    static private final long[] bitMask = {
        0x0000000000000001, 0x0000000000000002, 0x0000000000000004, 0x0000000000000008,
        0x0000000000000010, 0x0000000000000020, 0x0000000000000040, 0x0000000000000080,
        ...
    };

    static private final long[] diagonalMaskEx = {
        0x8040201008040200, 0x0080402010080400, 0x0000804020100800, 0x0000008040201000,
        0x0000000080402000, 0x0000000000804000, 0x0000000000008000, 0x0000000000000000,
        ...
    };

    /**
     * @param occ - occupancy
     *        sq  - from square
     * @return diagonal attacks from sq with occupancy occ
     */
    static public long diagonalAttacks(long occ, int sq)
    {
       long forward = occ &amp; diagonalMaskEx[sq];
       long reverse = Long.reverseBytes(forward);
       forward -= bitMask[sq];
       reverse -= bitMask[sq^56];
       forward ^= Long.reverseBytes(reverse);
       forward &amp;= diagonalMaskEx[sq];
       return forward;
    }
</pre>
<p><a class="external text" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Long.html.html#reverse%28long%29" rel="nofollow">Long.reverse</a> for a generalized attack getter even for ranks is too expensive, except a <a class="external text" href="https://en.wikipedia.org/wiki/Java_Virtual_Machine" rel="nofollow">JVM</a> can use a machine instruction rather than a <a href="Flipping Mirroring and Rotating.html#Rotationby180degrees" title="Flipping Mirroring and Rotating">bit-reversal</a> routine:
</p>
<pre>
    /**
     * @param occ  - occupancy
     *        line - {0..3} {rank, file, diagonal, antidiagonal}
     *        sq   - from square
     * @return attacks from sq on line with occupancy occ
     */
    static public long attacks(long occ, int line, int sq)
    {
       long forward = occ &amp; maskEx[sq][line];
       long reverse = Long.reverse(forward);
       forward -= bitMask[sq];
       reverse -= bitMask[sq^63];
       forward ^= Long.reverse(reverse);
       forward &amp;= maskEx[sq][line];
       return forward;
    }
</pre>
<h1><span class="mw-headline" id="See_also">See also</span></h1>
<ul><li> <a href="Reverse Bitboards.html" title="Reverse Bitboards">Reverse Bitboards</a></li>
<li> <a href="Obstruction Difference.html" title="Obstruction Difference">Obstruction Difference</a></li>
<li> <a href="SBAMG.html" title="SBAMG">SBAMG</a></li>
<li> <a href="SSSE3.html#SSSE3Version" title="SSSE3">SSSE3 Hyperbola Quintessence</a></li>
<li> <a href="Subtracting a Rook from a Blocking Piece.html" title="Subtracting a Rook from a Blocking Piece">Subtracting a Rook from a Blocking Piece</a></li></ul>
<h1><span class="mw-headline" id="Forum_Posts">Forum Posts</span></h1>
<ul><li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?topic view=threads&amp;p=140314.html" rel="nofollow">Re: BitBoard Tests Magic v Non-Rotated 32 Bits v 64 Bits</a> by <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a>, <a href="CCC.html" title="CCC">CCC</a>, August 25, 2007</li>
<li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=25979.html" rel="nofollow">Hyperbola Quiesscene: hardly any improvement</a> by trojanfoe, <a href="CCC.html" title="CCC">CCC</a>, January 13, 2009</li>
<li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=58795.html" rel="nofollow">Comparison of bitboard attack-getter variants</a> by <a href="Sven Sch%C3%BCle.html" title="Sven Schüle">Sven Schüle</a>, <a href="CCC.html" title="CCC">CCC</a>, January 04, 2016</li>
<li> <a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=58667&amp;start=106.html" rel="nofollow">Re: The wrong way</a> by <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a>, <a href="CCC.html" title="CCC">CCC</a>, January 05, 2016 » <a href="SSSE3.html#SSSE3Version" title="SSSE3">SSSE3 Hyperbola Quintessence</a></li>
<li> <a class="external text" href="http://www.talkchess.com/forum3/viewtopic.php?f=7&amp;t=71312.html" rel="nofollow">Understanding first rank attack state generation</a> by <a class="new" href="index.php?title=Kalyankumar Ramaseshan&amp;action=edit&amp;redlink=1.html" title="Kalyankumar Ramaseshan (page does not exist)">Kalyankumar Ramaseshan</a>, <a href="CCC.html" title="CCC">CCC</a>, July 18, 2019 » <a href="First Rank Attacks.html" title="First Rank Attacks">First Rank Attacks</a></li></ul>
<h1><span class="mw-headline" id="External_Links">External Links</span></h1>
<ul><li> <a class="external text" href="https://github.com/abulmo/hqperft" rel="nofollow">GitHub - abulmo/hqperft: Chess move generation based on (H)yperbola (Q)uintessence &amp; range attacks</a> by <a href="Richard Delorme.html" title="Richard Delorme">Richard Delorme</a> » <a href="Perft.html" title="Perft">Perft</a></li>
<li> <a class="external text" href="http://www.youtube.com/watch?v=bCH4YK6oq8M&amp;list=SPQV5mozTHmacMeRzJCW 8K3qw2miYqd0c&amp;index=9.html" rel="nofollow">Sliding Pieces (Part 1) - Advanced Java Chess Engine Tutorial 8</a> by <a href="Jonathan Warkentin.html" title="Jonathan Warkentin">Jonathan Warkentin</a></li>
<li> <a class="external text" href="http://timcooijmans.blogspot.co.uk/2014/04/hyperbola-quintessence-for-rooks-along.html.html" rel="nofollow">Hyperbola Quintessence for rooks along ranks</a> by <a class="external text" href="https://www.blogger.com/profile/11033414990764447420" rel="nofollow">Tim Cooijmans</a>, April 6, 2014 <sup class="reference" id="cite_ref-7"><a href="#cite note-7">[7]</a></sup></li></ul>
<h2><span class="mw-headline" id="Hyperbola">Hyperbola</span></h2>
<ul><li> <a class="external text" href="https://en.wikipedia.org/wiki/Hyperbola" rel="nofollow">Hyperbola from Wikipedia</a></li>
<li> <a class="external text" href="http://www.paideiaschool.org/TeacherPages/Steve Sigur/resources/Eulerian%20hyperbola/Eulerian%20hyperbola.html.html" rel="nofollow">The Eulerian Hyperbola</a></li>
<li> <a class="external text" href="http://www.mathwords.com/f/foci hyperbola.htm.html" rel="nofollow">Foci of a Hyperbola</a> from <a class="external text" href="http://www.mathwords.com/.html" rel="nofollow">mathwords.com</a></li></ul>
<h2><span class="mw-headline" id="Quintessence">Quintessence</span></h2>
<ul><li> <a class="external text" href="https://en.wikipedia.org/wiki/Quintessence" rel="nofollow">Quintessence from Wikipedia</a></li>
<li> <a class="external text" href="https://en.wikipedia.org/wiki/Quintessence_(physics)" rel="nofollow">Quintessence (physics) from Wikipedia</a></li>
<li> <a class="external text" href="https://en.wikipedia.org/wiki/Aether_(classical_element)#Fifth_element" rel="nofollow">Quintessence the Fifth Element from Wikipedia</a></li></ul>
<h2><span class="mw-headline" id="Misc">Misc</span></h2>
<ul><li> <a href="Category:Focus.html" title="Category:Focus">Focus</a> - <a class="external text" href="https://en.wikipedia.org/wiki/Hocus_Pocus_%28song%29" rel="nofollow">Hocus Pocus</a>, <a class="external text" href="https://en.wikipedia.org/wiki/Pinkpop_Festival" rel="nofollow">Pinkpop Festival</a> 1972, <a class="external text" href="https://en.wikipedia.org/wiki/Geleen" rel="nofollow">Geleen</a>, <a class="external text" href="https://en.wikipedia.org/wiki/YouTube" rel="nofollow">YouTube</a> Video</li></ul>
<dl><dd> <div class="embedvideo ev_inline ev_top autoResize" style=" width: 646px;"><div class="embedvideowrap" style="width: 640px;"><iframe allowfullscreen="true" frameborder="0" height="360" src="//www.youtube.com/embed/5-adsDeltaM?" width="640"></iframe></div></div></dd></dl>
<h1><span class="mw-headline" id="References">References</span></h1>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite ref-1">↑</a></span> <span class="reference-text"><a class="external text" href="https://www.puckergallery.com/artists/#/samuel-bak/" rel="nofollow">Samuel Bak - represented by Pucker Gallery since 1969</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite ref-2">↑</a></span> <span class="reference-text"><a class="external text" href="http://msdn.microsoft.com/en-us/library/a3140177.aspx.html" rel="nofollow">_byteswap_uint64</a> Visual C++ Developer Center - Run-Time Library Reference</span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite ref-3">↑</a></span> <span class="reference-text"><a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?topic view=threads&amp;p=140314.html" rel="nofollow">Re: BitBoard Tests Magic v Non-Rotated 32 Bits v 64 Bits</a> by <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a>, <a href="CCC.html" title="CCC">CCC</a>, August 25, <a href="Timeline.html#2007" title="Timeline">2007</a></span>
</li>
<li id="cite_note-4"><span class="mw-cite-backlink"><a href="#cite ref-4">↑</a></span> <span class="reference-text"><a class="external text" href="http://www.intel.com/assets/pdf/manual/248966.pdf.html" rel="nofollow">Intel 64 and IA32 Architectures Optimization Reference Manual</a> (pdf)</span>
</li>
<li id="cite_note-5"><span class="mw-cite-backlink"><a href="#cite ref-5">↑</a></span> <span class="reference-text"><a class="external text" href="http://msdn.microsoft.com/en-us/library/bb531427.aspx.html" rel="nofollow">_mm_shuffle_epi8</a> Visual C++ Developer Center - Run-Time Library Reference</span>
</li>
<li id="cite_note-6"><span class="mw-cite-backlink"><a href="#cite ref-6">↑</a></span> <span class="reference-text"><a class="external text" href="http://timcooijmans.blogspot.co.uk/2014/04/hyperbola-quintessence-for-rooks-along.html.html" rel="nofollow">Hyperbola Quintessence for rooks along ranks</a> by <a class="external text" href="https://www.blogger.com/profile/11033414990764447420" rel="nofollow">Tim Cooijmans</a>, April 6, 2014</span>
</li>
<li id="cite_note-7"><span class="mw-cite-backlink"><a href="#cite ref-7">↑</a></span> <span class="reference-text"><a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?t=58795&amp;start=10.html" rel="nofollow">Re: Comparison of bitboard attack-getter variants</a> by <a href="Matthew R. Brades.html" title="Matthew R. Brades">Matthew R. Brades</a>, <a href="CCC.html" title="CCC">CCC</a>, January 04, 2016</span>
</li>
</ol></div>
<p><b><a href="Sliding Piece Attacks.html" title="Sliding Piece Attacks">Up one Level</a></b>
</p>
<!-- 
NewPP limit report
Cached time: 20240722195804
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.030 seconds
Real time usage: 0.033 seconds
Preprocessor visited node count: 271/1000000
Preprocessor generated node count: 582/1000000
Post‐expand include size: 270/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    1.114      1 Template:MappingHint
100.00%    1.114      1 -total
-->
</div>
<!-- Saved in parser cache with key oscar70_mw1-mw_:pcache:idhash:1629-0!canonical and timestamp 20240722195804 and revision id 13377
 -->
</div> <div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://www.chessprogramming.org/index.php?title=Hyperbola_Quintessence&amp;oldid=13377">https://www.chessprogramming.org/index.php?title=Hyperbola_Quintessence&amp;oldid=13377</a>"					</div>
<div class="catlinks" data-mw="interface" id="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a href="Special:Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category:Samuel Bak.html" title="Category:Samuel Bak">Samuel Bak</a></li><li><a href="Category:Focus.html" title="Category:Focus">Focus</a></li></ul></div></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div aria-labelledby="p-personal-label" class="" id="p-personal" role="navigation">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-login"><a accesskey="o" href="index.php?title=Special:UserLogin&amp;returnto=Hyperbola+Quintessence&amp;returntoquery=printable%3Dyes.html" title="You are encouraged to log in; however, it is not mandatory [o]">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div aria-labelledby="p-namespaces-label" class="vectorTabs" id="p-namespaces" role="navigation">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li class="selected" id="ca-nstab-main"><span><a accesskey="c" href="Hyperbola Quintessence.html" title="View the content page [c]">Page</a></span></li>
<li class="new" id="ca-talk"><span><a accesskey="t" href="index.php?title=Talk:Hyperbola Quintessence&amp;action=edit&amp;redlink=1.html" rel="discussion" title="Discussion about the content page [t]">Discussion</a></span></li>
</ul>
</div>
<div aria-labelledby="p-variants-label" class="vectorMenu emptyPortlet" id="p-variants" role="navigation">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div aria-labelledby="p-views-label" class="vectorTabs" id="p-views" role="navigation">
<h3 id="p-views-label">Views</h3>
<ul>
<li class="selected" id="ca-view"><span><a href="Hyperbola Quintessence.html">Read</a></span></li>
<li id="ca-viewsource"><span><a accesskey="e" href="index.php?title=Hyperbola Quintessence&amp;action=edit.html" title="This page is protected.
You can view its source [e]">View source</a></span></li>
<li class="collapsible" id="ca-history"><span><a accesskey="h" href="index.php?title=Hyperbola Quintessence&amp;action=history.html" title="Past revisions of this page [h]">View history</a></span></li>
</ul>
</div>
<div aria-labelledby="p-cactions-label" class="vectorMenu emptyPortlet" id="p-cactions" role="navigation">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/index.php" id="searchform">
<div id="simpleSearch">
<input accesskey="f" id="searchInput" name="search" placeholder="Search Chessprogramming wiki" title="Search Chessprogramming wiki [f]" type="search"/><input name="title" type="hidden" value="Special:Search"/><input class="searchButton mw-fallbackSearchButton" id="mw-searchButton" name="fulltext" title="Search the pages for this text" type="submit" value="Search"/><input class="searchButton" id="searchButton" name="go" title="Go to a page with this exact name if it exists" type="submit" value="Go"/> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main Page.html" title="Visit the main page"></a></div>
<div aria-labelledby="p-navigation-label" class="portal" id="p-navigation" role="navigation">
<h3 id="p-navigation-label">Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a accesskey="z" href="Main Page.html" title="Visit the main page [z]">Main page</a></li><li id="n-recentchanges"><a accesskey="r" href="Special:RecentChanges.html" title="A list of recent changes in the wiki [r]">Recent changes</a></li><li id="n-randompage"><a accesskey="x" href="Special:Random.html" title="Load a random page [x]">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li> </ul>
</div>
</div>
<div aria-labelledby="p-tb-label" class="portal" id="p-tb" role="navigation">
<h3 id="p-tb-label">Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a accesskey="j" href="Special:WhatLinksHere/Hyperbola Quintessence.html" title="A list of all wiki pages that link here [j]">What links here</a></li><li id="t-recentchangeslinked"><a accesskey="k" href="Special:RecentChangesLinked/Hyperbola Quintessence.html" rel="nofollow" title="Recent changes in pages linked from this page [k]">Related changes</a></li><li id="t-specialpages"><a accesskey="q" href="Special:SpecialPages.html" title="A list of all special pages [q]">Special pages</a></li><li id="t-permalink"><a href="index.php?title=Hyperbola Quintessence&amp;oldid=13377.html" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="index.php?title=Hyperbola Quintessence&amp;action=info.html" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 19 July 2019, at 21:03.</li>
<li id="footer-info-copyright">Content is available under <a href="Chessprogramming:About.html" title="Chessprogramming:About">Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="Chessprogramming:Privacy policy.html" title="Chessprogramming:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="Chessprogramming:About.html" title="Chessprogramming:About">About Chessprogramming wiki</a></li>
<li id="footer-places-disclaimer"><a href="Chessprogramming:General disclaimer.html" title="Chessprogramming:General disclaimer">Disclaimers</a></li>
<li id="footer-places-mobileview"><a class="noprint stopMobileRedirectToggle" href="https://www.chessprogramming.org/index.php?title=Hyperbola_Quintessence&amp;printable=yes&amp;mobileaction=toggle_view_mobile">Mobile view</a></li>
</ul>
<ul class="noprint" id="footer-icons">
<li id="footer-copyrightico">
<a href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)" height="31" src="images/cc-by-sa.png" width="88"/></a> </li>
<li id="footer-poweredbyico">
<a href="/www.mediawiki.org/.html"><img alt="Powered by MediaWiki" height="31" src="resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88"/></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.030","walltime":"0.033","ppvisitednodes":{"value":271,"limit":1000000},"ppgeneratednodes":{"value":582,"limit":1000000},"postexpandincludesize":{"value":270,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    1.114      1 Template:MappingHint","100.00%    1.114      1 -total"]},"cachereport":{"timestamp":"20240722195804","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":44});});</script>
</body>
</html>
