<!DOCTYPE html>

<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="utf-8"/>
<title>SSSE3 - Chessprogramming wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SSSE3","wgTitle":"SSSE3","wgCurRevisionId":5697,"wgRevisionId":5697,"wgArticleId":3796,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SSSE3","wgRelevantArticleId":3796,"wgRequestId":"Zp7DrbG9G67YuqUGxlgchQAAAAE","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","wgMFExpandAllSectionsUserOption":false,"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","ext.cite.styles":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0kthzed",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["ext.cite.a11y","site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=ext.cite.styles%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<script async="" src="/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=vector"></script>
<meta content="" name="ResourceLoaderDynamicStyles"/>
<link href="/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;printable=1&amp;skin=vector" rel="stylesheet"/>
<meta content="MediaWiki 1.30.1" name="generator"/>
<meta content="noindex,follow" name="robots"/>
<link href="/images/favicon.ico" rel="shortcut icon"/>
<link href="/opensearch_desc.php" rel="search" title="Chessprogramming wiki (en)" type="application/opensearchdescription+xml"/>
<link href="https://www.chessprogramming.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link href="/Chessprogramming:About" rel="license"/>
<link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="Chessprogramming wiki Atom feed" type="application/atom+xml"/>
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js?40bd4"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SSSE3 rootpage-SSSE3 skin-vector action-view"> <div class="noprint" id="mw-page-base"></div>
<div class="noprint" id="mw-head-base"></div>
<div class="mw-body" id="content" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 class="firstHeading" id="firstHeading" lang="en">SSSE3</h1>
<div class="mw-body-content" id="bodyContent">
<div class="noprint" id="siteSub">From Chessprogramming wiki</div>
<div id="contentSub"></div>
<div class="mw-jump" id="jump-to-nav">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
</div>
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output"><p><b><a href="Main Page.html" title="Main Page">Home</a> * <a href="Hardware.html" title="Hardware">Hardware</a> * <a href="X86.html" title="X86">x86</a> * SSSE3</b>
</p><p><b>SSSE3</b> (Supplemental Streaming SIMD Extension 3) is <a href="Intel.html" title="Intel">Intel's</a> name for the <a href="SSE.html" title="SSE">SSE</a> instruction set's fourth iteration. 16 new instructions, also available as <a href="MMX.html" title="MMX">MMX</a>-extension with _m64 intrinsic datatype. SSSE3 was introduced in <a class="external text" href="https://en.wikipedia.org/wiki/Intel_Core_microarchitecture" rel="nofollow">Intel's Core Microarchitecture</a>. SSSE3-intrinsic functions are available in <a class="external text" href="https://en.wikipedia.org/wiki/Visual_C%2B%2B" rel="nofollow">Visual C</a> <sup class="reference" id="cite_ref-1"><a href="#cite note-1">[1]</a></sup> or <a class="external text" href="https://en.wikipedia.org/wiki/Intel_C%2B%2B_Compiler" rel="nofollow">Intel-C</a> <sup class="reference" id="cite_ref-2"><a href="#cite note-2">[2]</a></sup> .
</p><p>SSSE3 instructions are not available for <a href="AMD.html" title="AMD">AMD</a> processors until Bulldozer, which also implements <a href="SSE4.html" title="SSE4">SSE4</a> and <a href="AVX.html" title="AVX">AVX</a>.
</p>
<div class="toc" id="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Instructions"><span class="tocnumber">1</span> <span class="toctext">Instructions</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#PH.28ADD.2FSUB.29W"><span class="tocnumber">1.1</span> <span class="toctext">PH(ADD/SUB)W</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#Intrinsic"><span class="tocnumber">1.1.1</span> <span class="toctext">Intrinsic</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#Pseudocode"><span class="tocnumber">1.1.2</span> <span class="toctext">Pseudocode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#PMADDUBSW"><span class="tocnumber">1.2</span> <span class="toctext">PMADDUBSW</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Intrinsic 2"><span class="tocnumber">1.2.1</span> <span class="toctext">Intrinsic</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Pseudocode 2"><span class="tocnumber">1.2.2</span> <span class="toctext">Pseudocode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#PMULHRSW"><span class="tocnumber">1.3</span> <span class="toctext">PMULHRSW</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Intrinsic 3"><span class="tocnumber">1.3.1</span> <span class="toctext">Intrinsic</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Pseudocode 3"><span class="tocnumber">1.3.2</span> <span class="toctext">Pseudocode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#PSHUFB"><span class="tocnumber">1.4</span> <span class="toctext">PSHUFB</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Intrinsic 4"><span class="tocnumber">1.4.1</span> <span class="toctext">Intrinsic</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Pseudocode 4"><span class="tocnumber">1.4.2</span> <span class="toctext">Pseudocode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="#PSIGN"><span class="tocnumber">1.5</span> <span class="toctext">PSIGN</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#Intrinsic 5"><span class="tocnumber">1.5.1</span> <span class="toctext">Intrinsic</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Pseudocode 5"><span class="tocnumber">1.5.2</span> <span class="toctext">Pseudocode</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Applications"><span class="tocnumber">2</span> <span class="toctext">Applications</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#SSE3 Population Count"><span class="tocnumber">2.1</span> <span class="toctext">SSE3 Population Count</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Byte-wise Dot-Product"><span class="tocnumber">2.2</span> <span class="toctext">Byte-wise Dot-Product</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#SSSE3 Hyperbola Quintessence"><span class="tocnumber">2.3</span> <span class="toctext">SSSE3 Hyperbola Quintessence</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#Intrinsic Version"><span class="tocnumber">2.3.1</span> <span class="toctext">Intrinsic Version</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#Peshkov.27s Optimization"><span class="tocnumber">2.3.2</span> <span class="toctext">Peshkov's Optimization</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#See also"><span class="tocnumber">3</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="#External Links"><span class="tocnumber">4</span> <span class="toctext">External Links</span></a></li>
<li class="toclevel-1 tocsection-25"><a href="#References"><span class="tocnumber">5</span> <span class="toctext">References</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="Instructions">Instructions</span></h1>
<p>Some of the new instructions are quite interesting for computer chess, with applications in <a href="Evaluation.html" title="Evaluation">evaluation</a> and byte shuffling of <a href="Bitboards.html" title="Bitboards">bitboards</a>.
<span id="PHADDSW"></span>
</p>
<h2><span class="mw-headline" id="PH.28ADD.2FSUB.29W">PH(ADD/SUB)W</span></h2>
<p>Packed Horizontal Add/Subtract Words. Each of the eight shorts integers is the sum/difference between adjacent pairs of elements in the input parameters. Saturating versions, PHADDSW and PHSUBSW, are also available.
</p><p>The primary downside of these instructions is that they tend to be very slow multiple-uop instructions on most CPUs, resulting in alternate instruction sequences almost always being faster.
</p>
<h3><span class="mw-headline" id="Intrinsic">Intrinsic</span></h3>
<p>_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb514049%28v=vs.100%29.aspx.html" rel="nofollow">_mm_hadd_epi16</a> (_m128i a, _m128i b);
</p>
<h3><span class="mw-headline" id="Pseudocode">Pseudocode</span></h3>
<pre>
signed short a[ 8]; // input a
signed short b[ 8]; // input b
signed short r[ 8]; // output r

for (i=0; i &lt; 4; i++) {
   r[  i] = a[2i] + a[2i+1];
   r[4+i] = b[2i] + b[2i+1];
}
</pre>
<p><span id="PMADDUBSW"></span>
</p>
<h2><span class="mw-headline" id="PMADDUBSW">PMADDUBSW</span></h2>
<p>Packed Multiply and Add a vector of 16 unsigned bytes (char) with a vector of 16 signed bytes (not <a class="external text" href="https://en.wikipedia.org/wiki/Commutative" rel="nofollow">commutative</a>! <sup class="reference" id="cite_ref-3"><a href="#cite note-3">[3]</a></sup> ). Two consecutive products are added and the saturated signed 16-bit results are stored as vector of eight signed shorts.
</p>
<h3><span class="mw-headline" id="Intrinsic_2">Intrinsic</span></h3>
<p>_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb514017%28v=vs.100%29.aspx.html" rel="nofollow">_mm_maddubs_epi16</a> (_m128i a, _m128i b); 
</p>
<h3><span class="mw-headline" id="Pseudocode_2">Pseudocode</span></h3>
<pre>
unsigned char  a[16]; // input a
signed   char  b[16]; // input b
signed   short r[ 8]; // output r

for (i=0; i &lt; 8; i++)
   r[i] = SATURATE_16(a[2i]*b[2i] + a[2i+1] * b[2i+1]);
</pre>
<p><span id="PMULHRSW"></span>
</p>
<h2><span class="mw-headline" id="PMULHRSW">PMULHRSW</span></h2>
<p>Packed Multiply High with Round and Scale is an instruction designed for fixed-point math. It is similar to the existing pmulhw, but only shifts right by 15 instead of 16, and adds a factor for correct rounding.
</p>
<h3><span class="mw-headline" id="Intrinsic_3">Intrinsic</span></h3>
<p>_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb513995%28v=vs.100%29.aspx.html" rel="nofollow">_mm_mulhrs_epi16</a> (_m128i a, _m128i b);
</p>
<h3><span class="mw-headline" id="Pseudocode_3">Pseudocode</span></h3>
<pre>
signed short a[8]; // input a
signed short b[8]; // input b
signed short r[8]; // output r

for (i=0; i &lt; 8; i++)
   r[i] = INT16((a[i]*b[i] + 0x4000) &gt;&gt; 15);
</pre>
<p><span id="PSHUFB"></span>
</p>
<h2><span class="mw-headline" id="PSHUFB">PSHUFB</span></h2>
<p>Packed Shuffle Bytes is a very powerful instruction that can perform a fast arbitrary byte-shuffle of a register. It can also set some output bytes to zero instead of selecting them from the input. Packed Shuffle Bytes is used inside the <a href="SSSE3.html#SSSE3Version" title="SSSE3">SSSE3 Version of Hyperbola Quintessence</a> to perform byte swaps. There might be some other interesting applications too, such as <a href="SSSE3.html#PopCount" title="SSSE3">SSSE3 Population Count</a>. <a href="XOP.html#VPPERM" title="XOP">VPPERM</a> from <a href="XOP.html" title="XOP">XOP</a> is an even more powerful variant on this instruction.
</p>
<h3><span class="mw-headline" id="Intrinsic_4">Intrinsic</span></h3>
<p>_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb531427%28v=vs.100%29.aspx.html" rel="nofollow">_mm_shuffle_epi8</a> (_m128i a, _m128i b);
</p>
<h3><span class="mw-headline" id="Pseudocode_4">Pseudocode</span></h3>
<pre>
char a[16]; // input a
char b[16]; // input b
char r[16]; // output r

for (i=0; i &lt; 16; i++)
   r[i] = (b[i] &lt; 0) ? 0 : a[b[i] % 16];
</pre>
<p><span id="PSIGN"></span>
</p>
<h2><span class="mw-headline" id="PSIGN">PSIGN</span></h2>
<p>Multiplies each element of one vector with the <a class="external text" href="https://en.wikipedia.org/wiki/Sign_function" rel="nofollow">sign function</a> {-1,0,1} of the second vector. The instruction is available for signed <a href="Byte.html" title="Byte">bytes</a> (8-bit char psignb), signed <a href="Word.html" title="Word">words</a> (16-bit short psignw) and <a href="Double Word.html" title="Double Word">double words</a> (32-bit int psignd). If both input operands are equal, the result is a vector of absolute values, though PABS is probably preferred for this purpose.
</p>
<h3><span class="mw-headline" id="Intrinsic_5">Intrinsic</span></h3>
<p>_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb531461%28v=vs.100%29.aspx.html" rel="nofollow">_mm_sign_epi8</a> (_m128i a, _m128i b);
_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb531410%28v=vs.100%29.aspx.html" rel="nofollow">_mm_sign_epi16</a> (_m128i a, _m128i b);
_m128i <a class="external text" href="http://msdn.microsoft.com/en-us/library/bb514081%28v=vs.100%29.aspx.html" rel="nofollow">_mm_sign_epi32</a> (_m128i a, _m128i b);
</p>
<h3><span class="mw-headline" id="Pseudocode_5">Pseudocode</span></h3>
<pre>
/* type := {char, short, int}, N = {16, 8, 4} */
#define N (sizeof(__m128i)/sizeof(type))
type a[N]; // input a
type b[N]; // input b
type r[N]; // output r

for (i=0; i &lt; N; i++)
   r[i] = (b[i] &lt; 0) ? -a[i] : ((b[i] == 0) ? 0 : a[i])
</pre>
<h1><span class="mw-headline" id="Applications">Applications</span></h1>
<h2><span class="mw-headline" id="SSE3_Population_Count">SSE3 Population Count<span id="PopCount"></span></span></h2>
<p>In 2008, <a href="Wojciech Mu%C5%82a.html" title="Wojciech Muła">Wojciech Muła</a> introduced a SSSE3 <a href="Population Count.html" title="Population Count">Population Count</a> performing a pair of <a href="SSSE3.html#PSHUFB" title="SSSE3">PSHUFB</a> 16 parallel <a href="Nibble.html" title="Nibble">nibble</a> in-xmm lookups  <sup class="reference" id="cite_ref-4"><a href="#cite note-4">[4]</a></sup>, in the meantime due to <a href="AVX2.html" title="AVX2">AVX2</a> or <a href="AVX-512.html" title="AVX-512">AVX-512</a> even possible with doubled or fourfold register widths, competing the native <a href="X86-64.html" title="X86-64">x86-64</a> <a href="X86-64.html#gpinstructions" title="X86-64">popcount instruction</a> <sup class="reference" id="cite_ref-5"><a href="#cite note-5">[5]</a></sup>
</p>
<pre>
/**
 * popCount2 
 * @author Wojciech Muła
 * @param v vector of two bitboards
 * @return quad word vector of two popcounts
*/
__m128i popCount(__m128i v) {
  __m128i lu = _mm_setr_epi8(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4);
  __m128i lm = _mm_set1_epi8(0x0f);
  __m128i lo = _mm_and_si128(v, lm);
  __m128i hi = _mm_and_si128(_mm_srli_epi16(v, 4), lm);
  __m128i cl = _mm_shuffle_epi8(lu, lo); /* 16 low nibble counts */
  __m128i ch = _mm_shuffle_epi8(lu, hi); /* 16 high nibble counts */
  __m128i cb = _mm_add_epi8(cl, ch); /* 16 byte counts */
  return _mm_sad_epu8(cb, _mm_setzero_si128());
}
</pre>
<p><span id="DotProduct"></span>
</p>
<h2><span class="mw-headline" id="Byte-wise_Dot-Product">Byte-wise Dot-Product</span></h2>
<p>This SSSE3-dot-product multiplies a vector of 64 unsigned chars with a vector of 64 signed char, and adds all 64 intermediate signed 16-bit products with saturation. It uses the <a href="SSSE3.html#PMADDUBSW" title="SSSE3">pmaddubsw</a> and <a href="SSSE3.html#PHADDSW" title="SSSE3">phaddsw</a> SSSE3 instructions, in total 11 SSE instructions.
</p>
<pre>
int dotProduct(unsigned char features[], char weights[] /* XMM_ALIGN */) {
   __m128i r0, r1, r2, r3;
   __m128i* a = (__m128i*) features;
   __m128i* b = (__m128i*) weights;
   r0 = _mm_maddubs_epi16 (a[0], b[0]);
   r1 = _mm_maddubs_epi16 (a[1], b[1]);
   r2 = _mm_maddubs_epi16 (a[2], b[2]);
   r3 = _mm_maddubs_epi16 (a[3], b[3]);
   r0 = _mm_adds_epi16    (r0, r1);
   r2 = _mm_adds_epi16    (r2, r3);
   r0 = _mm_adds_epi16    (r0, r2); // 8 shorts
   r0 = _mm_hadds_epi16   (r0, r0); // 4 shorts
   r0 = _mm_hadds_epi16   (r0, r0); // 2 shorts
   r0 = _mm_hadds_epi16   (r0, r0); // 1 final short
   short s = (short)_mm_extract_epi16(r0, 0);
   return (int) s; // sign extended
}
</pre>
<p><span id="SSSE3Version"></span>
</p>
<h2><span class="mw-headline" id="SSSE3_Hyperbola_Quintessence">SSSE3 Hyperbola Quintessence</span></h2>
<p>Following routine calculates bishop attacks performing the <a href="Hyperbola Quintessence.html" title="Hyperbola Quintessence">Hyperbola Quintessence</a>. Both <a href="Anti-Diagonals.html" title="Anti-Diagonals">anti-diagonal</a> and <a href="Diagonals.html" title="Diagonals">diagonal</a> attacks are processed in parallel, using both halves of a 128-bit xmm register and pre-calculated <a href="Array.html" title="Array">arrays</a> of bitboard pairs for line-masks, single- and eventually reversed bits. <a href="SSSE3.html#PSHUFB" title="SSSE3">PSHUFB</a> is used to swap bytes inside a <a href="Bitboards.html" title="Bitboards">bitboard</a> <sup class="reference" id="cite_ref-6"><a href="#cite note-6">[6]</a></sup> .
</p>
<h3><span class="mw-headline" id="Intrinsic_Version">Intrinsic Version</span></h3>
<pre>
__m128i diaAntiMaskXMM[64]; // 1 KByte  antidiag : diagonal, excluding square
__m128i singleBitsXMM [64]; // 1 KByte    1&lt;&lt;sq  : 1&lt;&lt;sq
__m128i swapMaskXMM; // needs to be initialized to swap the bytes in both quad-words

// SSSE3 Hyperbola Quintessence
U64 bishopAttacks(U64 occ, enumSquare sq) {
   __m128i o, r, m, b, s;
   m = diaAntiMaskXMM[sq];         // antidiag : diagonal, excluding square
   b = singleBitsXMM [sq];         // bishop bits, equal qwords
   s = swapMaskXMM;
   o = _mm_cvtsi64x_si128  (occ) ; // general purpose 64 bit to xmm low qword
   o = _mm_unpacklo_epi64  (o, o); // occ : occ
   o = _mm_and_si128       (o, m); // o (antidiag : diagonal)
   r = _mm_shuffle_epi8    (o, s); // o'(antidiag : diagonal)
   o = _mm_sub_epi64       (o, b); // o - bishop
   b = _mm_shuffle_epi8    (b, s); // bishop', one may also use singleBitsXMM [sq^56]
   r = _mm_sub_epi64       (r, b); // o'- bishop'
   r = _mm_shuffle_epi8    (r, s); // re-reverse
   o = _mm_xor_si128       (o, r); // attacks
   o = _mm_and_si128       (o, m); // antidiag : diagonal
   r = _mm_unpackhi_epi64  (o, o); // antidiag : antidiag
   o = _mm_add_epi64       (o, r); // diagonal + antidiag
   return _mm_cvtsi128_si64(o);    // convert xmm to general purpose 64 bit
}
</pre>
<p><span id="Peshkov"></span>
</p>
<h3><span class="mw-headline" id="Peshkov.27s_Optimization">Peshkov's Optimization</span></h3>
<p>The pioneer of Hyperbola Quintessence, <a href="Aleks Peshkov.html" title="Aleks Peshkov">Aleks Peshkov</a>, applies a more sophisticated, optimized <a href="Cpp.html" title="Cpp">C++</a> approach, further utilizing disjoint ray-attacks, and <a href="General Setwise Operations.html#ExclusiveOr" title="General Setwise Operations">xor</a> instruction is own inverse and distributive over <a href="Flipping Mirroring and Rotating.html" title="Flipping Mirroring and Rotating">mirroring or flipping</a>. Once per <a href="Node.html" title="Node">node</a> he instantiates an <a href="Occupancy.html" title="Occupancy">occupied object</a> based on a <a class="external text" href="https://en.wikipedia.org/wiki/Type_safety" rel="nofollow">type-safe</a> <a class="external text" href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern" rel="nofollow">curiously recurring template pattern</a> aka the <a class="external text" href="https://en.wikipedia.org/wiki/Barton%E2%80%93Nackman_trick" rel="nofollow">Barton–Nackman trick</a> to encapsulate the SSE intrinsic data types, to keep a twin of normal and flipped occupancy as base for further <a href="Files.html" title="Files">file</a>-, <a href="Diagonals.html" title="Diagonals">diagonal</a> or <a href="Anti-Diagonals.html" title="Anti-Diagonals">anti-diagonal</a> attack generations, which then requires only one final shuffle per piece attack getter, whether it is a bishop or even a queen.
</p>
<pre>
class Occupied : public BitSet&lt;Occupied, char_x16_t&gt; {
    typedef BitSet&lt;Occupied, char_x16_t&gt; Base;

    struct Mask {
        value_type singleton;
        value_type file;
        value_type diagonal;
        value_type antidiag;

        Mask operator () (Square);
    };
    typedef Square::const_array&lt;Mask, Mask&gt; CACHE_ALIGN AttackMask;
    static const AttackMask mask;

    struct Shuffle {
        value_type hyperbola;
        value_type flipShift;
        Shuffle ();
    };
    static const Shuffle shuffle;

    static BitBoard bitboard(value_type value) {
        return BitBoard(static_cast&lt;BitBoard::value_type&gt;(_mm_cvtsi128_si64(value)));
    }

    static BitBoard hyperbola(value_type value) {
        value_type reverse = _mm_shuffle_epi8(value, shuffle.hyperbola);
        return bitboard(value ^ reverse); //xor is principal here
    }

    INLINE BitBoard bishopAttack(Square from) const {
        value_type d = value;
        value_type a = value;
        d &amp;= mask[from].diagonal;
        a &amp;= mask[from].antidiag;
        d = _mm_sub_epi64(d, mask[from].singleton);
        a = _mm_sub_epi64(a, mask[from].singleton);
        d &amp;= mask[from].diagonal;
        a &amp;= mask[from].antidiag;
        return hyperbola(d ^ a);
    }

    ...
public:
    Occupied (const BitBoard&amp; myB, const BitBoard&amp; opB) {
        value_type my = _mm_cvtsi64_si128(reinterpret_cast&lt;const U64&amp;&gt;(myB));
        value_type op = _mm_cvtsi64_si128(reinterpret_cast&lt;const U64&amp;&gt;(opB));
        op = _mm_shuffle_epi8(op, shuffle.flipShift);
        assert (Occupied(my &amp; op) == empty()); //no intersection
        this-&gt;value = my ^ op;
    }

    ...
};
</pre>
<h1><span class="mw-headline" id="See_also">See also</span></h1>
<ul><li> <a href="AltiVec.html" title="AltiVec">AltiVec</a></li>
<li> <a href="AVX.html" title="AVX">AVX</a></li>
<li> <a href="AVX2.html" title="AVX2">AVX2</a></li>
<li> <a href="AVX-512.html" title="AVX-512">AVX-512</a></li>
<li> <a href="MMX.html" title="MMX">MMX</a></li>
<li> <a href="SIMD and SWAR Techniques.html" title="SIMD and SWAR Techniques">SIMD and SWAR Techniques</a></li>
<li> <a href="SSE2.html" title="SSE2">SSE2</a></li>
<li> <a href="SSE3.html" title="SSE3">SSE3</a></li>
<li> <a href="SSE4.html" title="SSE4">SSE4</a></li>
<li> <a href="SSE5.html" title="SSE5">SSE5</a></li>
<li> <a href="X86-64.html" title="X86-64">x86-64</a></li>
<li> <a href="XOP.html" title="XOP">XOP</a></li></ul>
<h1><span class="mw-headline" id="External_Links">External Links</span></h1>
<ul><li> <a class="external text" href="https://en.wikipedia.org/wiki/SSSE3" rel="nofollow">SSSE3 from Wikipedia</a></li>
<li> <a class="external text" href="http://sseplus.sourceforge.net/index.html.html" rel="nofollow">SSEPlus Project Documentation</a></li>
<li> <a class="external text" href="http://www.agner.org/optimize/blog/.html" rel="nofollow">Agner`s CPU blog</a> by <a class="external text" href="http://www.agner.org/.html" rel="nofollow">Agner Fog</a></li>
<li> <a class="external text" href="http://0x80.pl/articles/sse-popcount.html.html" rel="nofollow">SSSE3: fast popcount</a> by <a href="Wojciech Mu%C5%82a.html" title="Wojciech Muła">Wojciech Muła</a>, May 24, 2008 » <a href="Population Count.html" title="Population Count">Population Count</a></li>
<li> <a class="external text" href="http://software.intel.com/sites/landingpage/IntrinsicsGuide/.html" rel="nofollow">Intel Intrinsics Guide</a></li></ul>
<h1><span class="mw-headline" id="References">References</span></h1>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite ref-1">↑</a></span> <span class="reference-text"><a class="external text" href="http://msdn.microsoft.com/en-us/library/vstudio/bb892952%28v=vs.100%29.aspx.html" rel="nofollow">Supplemental Streaming SIMD Extensions 3 Instructions</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite ref-2">↑</a></span> <span class="reference-text"><a class="external text" href="https://www.cs.fsu.edu/~engelen/courses/HPC-adv/intref_cls.pdf" rel="nofollow">Intel C++ Compiler for Linux Intrinsics Reference</a> (pdf)</span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite ref-3">↑</a></span> <span class="reference-text"><a class="external text" href="http://gcc.gnu.org/ml/gcc-patches/2008-03/msg00619.html.html" rel="nofollow">fixing SSSE3 pmaddubsw description</a> from the mail archive of the [<a class="external autonumber" href="mailto:gcc-patches@gcc.gnu.org%7Cgcc-patches@gcc.gnu.org.html" rel="nofollow">[1]</a>] mailing list for the <a href="Free Software Foundation.html#GCC" title="Free Software Foundation">GCC project</a></span>
</li>
<li id="cite_note-4"><span class="mw-cite-backlink"><a href="#cite ref-4">↑</a></span> <span class="reference-text"><a class="external text" href="http://0x80.pl/articles/sse-popcount.html.html" rel="nofollow">SSSE3: fast popcount</a> by <a href="Wojciech Mu%C5%82a.html" title="Wojciech Muła">Wojciech Muła</a>, May 24, 2008</span>
</li>
<li id="cite_note-5"><span class="mw-cite-backlink"><a href="#cite ref-5">↑</a></span> <span class="reference-text"><a href="Wojciech Mu%C5%82a.html" title="Wojciech Muła">Wojciech Muła</a>, <a class="external text" href="http://dblp.uni-trier.de/pers/hd/k/Kurz:Nathan.html" rel="nofollow">Nathan Kurz</a>, <a class="external text" href="https://github.com/lemire" rel="nofollow">Daniel Lemire</a> (<b>2016</b>). <i>Faster Population Counts Using AVX2 Instructions</i>. <a class="external text" href="https://arxiv.org/abs/1611.07612" rel="nofollow">arXiv:1611.07612</a></span>
</li>
<li id="cite_note-6"><span class="mw-cite-backlink"><a href="#cite ref-6">↑</a></span> <span class="reference-text"><a class="external text" href="http://www.talkchess.com/forum/viewtopic.php?topic view=threads&amp;p=367616&amp;t=35858.html" rel="nofollow">Re: Plain and fancy magic on modern hardware</a> by <a class="new" href="index.php?title=Robert Purves&amp;action=edit&amp;redlink=1.html" title="Robert Purves (page does not exist)">Robert Purves</a>, <a href="Computer Chess Forums.html" title="Computer Chess Forums">CCC</a>, August 23, 2010</span>
</li>
</ol></div>
<p><b><a href="X86.html" title="X86">Up one Level</a></b>
</p>
<!-- 
NewPP limit report
Cached time: 20240722085228
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.017 seconds
Real time usage: 0.018 seconds
Preprocessor visited node count: 277/1000000
Preprocessor generated node count: 512/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key oscar70_mw1-mw_:pcache:idhash:3796-0!canonical and timestamp 20240722085228 and revision id 5697
 -->
</div> <div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://www.chessprogramming.org/index.php?title=SSSE3&amp;oldid=5697">https://www.chessprogramming.org/index.php?title=SSSE3&amp;oldid=5697</a>"					</div>
<div class="catlinks catlinks-allhidden" data-mw="interface" id="catlinks"></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div aria-labelledby="p-personal-label" class="" id="p-personal" role="navigation">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-login"><a accesskey="o" href="index.php?title=Special:UserLogin&amp;returnto=SSSE3&amp;returntoquery=printable%3Dyes.html" title="You are encouraged to log in; however, it is not mandatory [o]">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div aria-labelledby="p-namespaces-label" class="vectorTabs" id="p-namespaces" role="navigation">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li class="selected" id="ca-nstab-main"><span><a accesskey="c" href="SSSE3.html" title="View the content page [c]">Page</a></span></li>
<li class="new" id="ca-talk"><span><a accesskey="t" href="index.php?title=Talk:SSSE3&amp;action=edit&amp;redlink=1.html" rel="discussion" title="Discussion about the content page [t]">Discussion</a></span></li>
</ul>
</div>
<div aria-labelledby="p-variants-label" class="vectorMenu emptyPortlet" id="p-variants" role="navigation">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div aria-labelledby="p-views-label" class="vectorTabs" id="p-views" role="navigation">
<h3 id="p-views-label">Views</h3>
<ul>
<li class="selected" id="ca-view"><span><a href="SSSE3.html">Read</a></span></li>
<li id="ca-viewsource"><span><a accesskey="e" href="index.php?title=SSSE3&amp;action=edit.html" title="This page is protected.
You can view its source [e]">View source</a></span></li>
<li class="collapsible" id="ca-history"><span><a accesskey="h" href="index.php?title=SSSE3&amp;action=history.html" title="Past revisions of this page [h]">View history</a></span></li>
</ul>
</div>
<div aria-labelledby="p-cactions-label" class="vectorMenu emptyPortlet" id="p-cactions" role="navigation">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/index.php" id="searchform">
<div id="simpleSearch">
<input accesskey="f" id="searchInput" name="search" placeholder="Search Chessprogramming wiki" title="Search Chessprogramming wiki [f]" type="search"/><input name="title" type="hidden" value="Special:Search"/><input class="searchButton mw-fallbackSearchButton" id="mw-searchButton" name="fulltext" title="Search the pages for this text" type="submit" value="Search"/><input class="searchButton" id="searchButton" name="go" title="Go to a page with this exact name if it exists" type="submit" value="Go"/> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main Page.html" title="Visit the main page"></a></div>
<div aria-labelledby="p-navigation-label" class="portal" id="p-navigation" role="navigation">
<h3 id="p-navigation-label">Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a accesskey="z" href="Main Page.html" title="Visit the main page [z]">Main page</a></li><li id="n-recentchanges"><a accesskey="r" href="Special:RecentChanges.html" title="A list of recent changes in the wiki [r]">Recent changes</a></li><li id="n-randompage"><a accesskey="x" href="Special:Random.html" title="Load a random page [x]">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li> </ul>
</div>
</div>
<div aria-labelledby="p-tb-label" class="portal" id="p-tb" role="navigation">
<h3 id="p-tb-label">Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a accesskey="j" href="Special:WhatLinksHere/SSSE3.html" title="A list of all wiki pages that link here [j]">What links here</a></li><li id="t-recentchangeslinked"><a accesskey="k" href="Special:RecentChangesLinked/SSSE3.html" rel="nofollow" title="Recent changes in pages linked from this page [k]">Related changes</a></li><li id="t-specialpages"><a accesskey="q" href="Special:SpecialPages.html" title="A list of all special pages [q]">Special pages</a></li><li id="t-permalink"><a href="index.php?title=SSSE3&amp;oldid=5697.html" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="index.php?title=SSSE3&amp;action=info.html" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 9 August 2018, at 13:01.</li>
<li id="footer-info-copyright">Content is available under <a href="Chessprogramming:About.html" title="Chessprogramming:About">Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="Chessprogramming:Privacy policy.html" title="Chessprogramming:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="Chessprogramming:About.html" title="Chessprogramming:About">About Chessprogramming wiki</a></li>
<li id="footer-places-disclaimer"><a href="Chessprogramming:General disclaimer.html" title="Chessprogramming:General disclaimer">Disclaimers</a></li>
<li id="footer-places-mobileview"><a class="noprint stopMobileRedirectToggle" href="https://www.chessprogramming.org/index.php?title=SSSE3&amp;printable=yes&amp;mobileaction=toggle_view_mobile">Mobile view</a></li>
</ul>
<ul class="noprint" id="footer-icons">
<li id="footer-copyrightico">
<a href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)" height="31" src="images/cc-by-sa.png" width="88"/></a> </li>
<li id="footer-poweredbyico">
<a href="/www.mediawiki.org/.html"><img alt="Powered by MediaWiki" height="31" src="resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88"/></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.017","walltime":"0.018","ppvisitednodes":{"value":277,"limit":1000000},"ppgeneratednodes":{"value":512,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20240722085228","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":45});});</script>
</body>
</html>
